<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Космический Защитник</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="description" content="Космическая игра-шутер">
    <meta name="keywords" content="игра, космос, шутер, arcade">
    <meta name="author" content="Your Name">
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            user-select: none; 
            touch-action: none; 
        }
        body { 
            background: #1a1a2e; 
            overflow: hidden; 
            font-family: 'Arial', sans-serif;
            touch-action: none;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas { 
            max-width: 100%;
            max-height: 100vh;
            background: #000;
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
        }
        #gameOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        #restartButton {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="gameOverlay">
        <h1 style="color: white;">Игра окончена!</h1>
        <p id="scoreDisplay" style="color: white; font-size: 24px;">Счет: 0</p>
        <button id="restartButton">Начать заново</button>
    </div>

    <script>
    class SpaceDefenderGame {
        constructor() {
            // Инициализация основных элементов
            this.canvas = document.getElementById('gameCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.overlay = document.getElementById('gameOverlay');
            this.scoreDisplay = document.getElementById('scoreDisplay');
            this.restartButton = document.getElementById('restartButton');

            // Звуки с GitHub Pages совместимыми путями
            this.sounds = {
                shoot: new Audio('assets/sounds/shoot.mp3'),
                explosion: new Audio('assets/sounds/explosion.mp3'),
                background: new Audio('assets/sounds/background.mp3')
            };

            // Настройка звуков
            Object.values(this.sounds).forEach(sound => {
                sound.volume = 0.3;
            });
            this.sounds.background.loop = true;

            // Привязка методов
            this.setupEventListeners();
            this.resizeCanvas();
            this.initGame();
        }

        setupEventListeners() {
            // Адаптивное управление
            this.canvas.addEventListener('mousemove', (e) => {
                const rect = this.canvas.getBoundingClientRect();
                this.player.x = e.clientX - rect.left - this.player.width / 2;
            });

            this.canvas.addEventListener('touchmove', (e) => {
                const rect = this.canvas.getBoundingClientRect();
                const touch = e.touches[0];
                this.player.x = touch.clientX - rect.left - this.player.width / 2;
            });

            this.restartButton.addEventListener('click', () => this.resetGame());
            window.addEventListener('resize', () => this.resizeCanvas());
        }

        resizeCanvas() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
        }

        initGame() {
            // Основная инициализация игровых объектов
            this.player = {
                x: this.canvas.width / 2,
                y: this.canvas.height - 100,
                width: 50,
                height: 50,
                speed: 5
            };

            this.enemies = [];
            this.bullets = [];
            this.score = 0;
            this.gameOver = false;

            this.startGameLoop();
        }

        startGameLoop() {
            const gameLoop = () => {
                if (!this.gameOver) {
                    this.update();
                    this.render();
                    requestAnimationFrame(gameLoop);
                } else {
                    this.endGame();
                }
            };
            requestAnimationFrame(gameLoop);
        }

        update() {
            // Логика обновления игровых объектов
            this.spawnEnemies();
            this.updateBullets();
            this.updateEnemies();
            this.checkCollisions();
        }

        render() {
            // Отрисовка игровых объектов
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            
            // Рисование игрока
            this.ctx.fillStyle = 'blue';
            this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);

            // Рисование врагов и пуль
            this.enemies.forEach(enemy => {
                this.ctx.fillStyle = 'red';
                this.ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });

            this.bullets.forEach(bullet => {
                this.ctx.fillStyle = 'white';
                this.ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
        }

        spawnEnemies() {
            if (Math.random() < 0.02) {
                this.enemies.push({
                    x: Math.random() * (this.canvas.width - 50),
                    y: -50,
                    width: 50,
                    height: 50,
                    speed: 2
                });
            }
        }

        updateBullets() {
            this.bullets.forEach((bullet, index) => {
                bullet.y -= 5;
                
                if (bullet.y < 0) {
                    this.bullets.splice(index, 1);
                }
            });
        }

        updateEnemies() {
            this.enemies.forEach((enemy, index) => {
                enemy.y += enemy.speed;
                
                if (enemy.y > this.canvas.height) {
                    this.enemies.splice(index, 1);
                }
            });
        }

        checkCollisions() {
            // Проверка столкновений
            this.bullets.forEach((bullet, bIndex) => {
                this.enemies.forEach((enemy, eIndex) => {
                    if (this.isColliding(bullet, enemy)) {
                        this.bullets.splice(bIndex, 1);
                        this.enemies.splice(eIndex, 1);
                        this.score++;
                        this.playSound('explosion');
                    }
                });
            });
        }

        isColliding(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                                      rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        playSound(soundName) {
            try {
                const sound = this.sounds[soundName].cloneNode();
                sound.play();
            } catch(e) {
                console.error(`Ошибка воспроизведения звука ${soundName}:`, e);
            }
        }

        shootBullet() {
            this.bullets.push({
                x: this.player.x + this.player.width / 2,
                y: this.player.y,
                width: 5,
                height: 15
            });
            this.playSound('shoot');
        }

        endGame() {
            this.overlay.style.display = 'flex';
            this.scoreDisplay.textContent = `Счет: ${this.score}`;
            this.playSound('explosion');
        }

        resetGame() {
            this.overlay.style.display = 'none';
            this.initGame();
        }

        startBackgroundMusic() {
            try {
                this.sounds.background.play();
            } catch(e) {
                console.error('Ошибка запуска фоновой музыки:', e);
            }
        }

        stopBackgroundMusic() {
            this.sounds.background.pause();
            this.sounds.background.currentTime = 0;
        }
    }

    // Создание игры при полной загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        const game = new SpaceDefenderGame();
        
        // Добавление автоматической стрельбы
        setInterval(() => {
            if (!game.gameOver) {
                game.shootBullet();
            }
        }, 300);

        // Начало фоновой музыки после взаимодействия пользователя
        document.body.addEventListener('click', () => {
            game.startBackgroundMusic();
        }, { once: true });
    });
    </script>

    <!-- Мета-теги для SEO и социальных сетей -->
    <meta property="og:title" content="Космический Защитник">
    <meta property="og:description" content="Захватывающая космическая аркадная игра">
    <meta property="og:image" content="preview.png">
    <meta name="twitter:card" content="summary_large_image">
</body>
</html>
